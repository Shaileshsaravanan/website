<!DOCTYPE html>
<html lang="en">
  {% include "header.html" %}
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <body class="text-white bg-black">    
        <section class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
            <span onclick="event.stopPropagation(); window.location.href='/mechanica'" class="cursor-pointer animate-fade-down text-neutral-700 bg-white hover:text-white hover:bg-neutral-700 px-1 rounded-md text-sm font-geist inline-flex items-center transition-colors duration-700 ease-in-out"><svg xmlns="http://www.w3.org/2000/svg" class="h-[1em] mr-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right-icon lucide-arrow-right"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>back to mechanica</span>
            <h1 class="pt-10 w-full text-5xl italic text-center animate-fade-down animate-delay-[800ms]">{{ project }}</h1>
            <p class="pb-10 text-center text-neutral-400 text-lg animate-fade-down animate-delay-[1200ms]">{{ project_data.data.desc }}</p>
        </section>
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 prose prose-invert font-geist mb-20 bg-white rounded-lg p-3 animate-fade-up animate-delay-[1700ms]">
            <div class="lg:float-left mr-6 mb-4 w-full h-96 lg:w-96 lg:h-96">
                <div class="h-full w-full animate-fade-up animate-delay-[2200ms] overflow-hidden">
                    <model-viewer 
                        class="h-full w-full"
                        src="https://raw.githubusercontent.com/Shaileshsaravanan/{{ project }}/main/.website/preview.glb"
                        shadow-intensity="1"
                        camera-controls
                        touch-action="pan-x">
                    </model-viewer>
                </div>
            </div>
            <div id="content" class="font-merriweather"></div>
        </div>
  </body>
</html>
<script>

    const projectData = {{ project_data | tojson }};

    fetch(projectData.content)
    .then(res => res.text())
    .then(md => {
        const html = marked.parse(md);
        const safe = DOMPurify.sanitize(html);
        document.getElementById("content").innerHTML = safe;

        const content = document.getElementById("content");
        const mainColour = projectData.data.mainColour;
        const subColour = projectData.data.subColour;

        const map = {
            h1: `text-3xl font-extrabold mt-6 mb-4 italic`,
            h2: `text-2xl font-bold mt-5 mb-3 italic`,
            h3: `text-xl font-bold mt-4 mb-3 italic`,
            h4: `text-lg font-semibold mt-4 mb-2 italic`,
            h5: `text-md font-semibold mt-3 mb-2 italic`,
            h6: `text-sm font-semibold mt-3 mb-2 opacity-90 italic`,
            p:  `text-sm leading-normal my-3 leading-7`,
            ul: "my-3 ml-6 list-disc",
            ol: "my-3 ml-6 list-decimal",
            li: "my-1",
            pre:"my-5 p-4 rounded-lg bg-neutral-900",
            table:"my-5",
            strong: "font-bold",
            b: "font-bold",
            em: "italic",
            i: "italic",
            code: "px-1 py-0.5 rounded bg-neutral-800 text-neutral-200",
            a: "underline underline-offset-2 transition-colors duration-700 ease-in-out",
        };

        Object.entries(map).forEach(([tag, classes]) => {
            content.querySelectorAll(tag).forEach(el =>
                el.classList.add(...classes.split(" "))
            );
        });

        content.querySelectorAll("h1,h2,h3,h4,h5,h6,p").forEach(el => {
            el.style.color = mainColour;
        });

        content.querySelectorAll("a").forEach(el => {
            el.style.color = 'white';
            el.style.backgroundColor = mainColour;
            el.style.borderRadius = '0.25rem';
            el.style.paddingRight = '0.2rem';
            el.style.paddingLeft = '0.2rem';
            el.addEventListener("mouseenter", () => {
                el.style.backgroundColor = subColour;
            });

            el.addEventListener("mouseleave", () => {
                el.style.backgroundColor = mainColour;
            });
        });

        const all = content.querySelectorAll("*");
        all.forEach(el => {
            el.classList.add("opacity-0");
        });
        all.forEach((el, index) => {
            setTimeout(() => {
                el.classList.remove("opacity-0");
                el.classList.add("animate-fade-up");
            }, 3500 + (index * 200));
        });

    })
    .catch(console.error);

</script>